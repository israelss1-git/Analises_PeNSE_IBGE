-- Verificação da amostra, entre as classes masculino e feminino
SELECT 
	CASE
		WHEN VB01001 = 1 THEN 'MASCULINO'
		ELSE 'FEMININO'
	END AS SEXO,
	COUNT(*) * 100.0 / SUM(COUNT(*)) OVER() AS PERCENTUAL
FROM [mova].[dbo].[PENSE_AMOSTRA2_ALUNO]
GROUP BY 
	CASE
		WHEN VB01001 = 1 THEN 'MASCULINO'
		ELSE 'FEMININO'
	END; 

-- Verificação da frequencia de satisfação corporal
SELECT
	VB11007 AS SATISFACAO,
	COUNT(VB11007) AS FREQUENCIA,
	COUNT(*) * 100.0 / SUM(COUNT(*)) OVER() AS PERCENTUAL
FROM [mova].[dbo].[PENSE_AMOSTRA2_ALUNO]
GROUP BY VB11007
ORDER BY VB11007;

-- MENOS DE 20% DA AMOSTRA APRESENTA INSATIFAÇÃOCOM O CORPO
SELECT
	CASE 
		WHEN VB11007 IN (1,2) THEN 'SATISFEITO'
		WHEN VB11007 IN (4,5) THEN 'INSATISFEITO'
		ELSE 'OUTROS'
	END AS SATISFACAO,
	COUNT(VB11007) AS FREQUENCIA,
	COUNT(*) * 100.0 / SUM(COUNT(*)) OVER() AS PERCENTUAL
FROM [mova].[dbo].[PENSE_AMOSTRA2_ALUNO]
GROUP BY 
	CASE 
		WHEN VB11007 IN (1,2) THEN 'SATISFEITO'
		WHEN VB11007 IN (4,5) THEN 'INSATISFEITO'
		ELSE 'OUTROS'
	END
ORDER BY FREQUENCIA DESC;

-- MENOS DE 20% DA AMOSTRA APRESENTA INSATIFAÇÃOCOM O CORPO DIVIDO ENTRE AS CLASSE DE SEXO
SELECT
	CASE 
		WHEN VB11007 IN (1,2) THEN 'SATISFEITO'
		WHEN VB11007 IN (4,5) THEN 'INSATISFEITO'
		ELSE 'OUTROS'
	END AS SATISFACAO,
	CASE
		WHEN VB01001 = 1 THEN 'MASCULINO'
		ELSE 'FEMININO'
	END AS SEXO,
	COUNT(VB11007) AS FREQUENCIA,
	COUNT(*) * 100.0 / SUM(COUNT(*)) OVER() AS PERCENTUAL
FROM [mova].[dbo].[PENSE_AMOSTRA2_ALUNO]
GROUP BY 
	CASE 
		WHEN VB11007 IN (1,2) THEN 'SATISFEITO'
		WHEN VB11007 IN (4,5) THEN 'INSATISFEITO'
		ELSE 'OUTROS'
	END,
	CASE
		WHEN VB01001 = 1 THEN 'MASCULINO'
		ELSE 'FEMININO'
	END
ORDER BY SATISFACAO, SEXO DESC;

-- CÁLCULO IMC DE TODO O GRUPO
SELECT
	VB17003 / POWER((VB17004 /100),2) AS IMC
FROM [mova].[dbo].[PENSE_AMOSTRA2_ALUNO];

-- CÁCLULO DO IMC DOS GRUPO QUE ESTÃO INSATISFEITOS COM A APARENCIA CORPORAL
SELECT
	CASE 
		WHEN VB17003 / POWER((VB17004 /100),2) <= 18.5 THEN 'ABAIXO DO PESO'
		WHEN VB17003 / POWER((VB17004 /100),2) >= 30 THEN 'ACIMA DO PESO'
		ELSE 'PESO NORMAL'
	END AS 'CLASSE IMC',	
	COUNT(VB17003) AS FREQUENCIA,
	COUNT(*) * 100.0 / SUM(COUNT(*)) OVER() AS PERCENTUAL
FROM [mova].[dbo].[PENSE_AMOSTRA2_ALUNO]
WHERE VB11007 IN (4,5)
GROUP BY 
	CASE 
		WHEN VB17003 / POWER((VB17004 /100),2) <= 18.5 THEN 'ABAIXO DO PESO'
		WHEN VB17003 / POWER((VB17004 /100),2) >= 30 THEN 'ACIMA DO PESO'
		ELSE 'PESO NORMAL'
	END;

-- PERCENTUAL DOS IMC DOS GRUPO QUE ESTÃO INSATISFEITOS COM A APARENCIA CORPORAL ENTRE AS CLASSES DE SEXO 
SELECT
	CASE 
		WHEN VB17003 / POWER((VB17004 /100),2) <= 18.5 THEN 'ABAIXO DO PESO'
		WHEN VB17003 / POWER((VB17004 /100),2) >= 30 THEN 'ACIMA DO PESO'
		ELSE 'PESO NORMAL'
	END AS CLASSE_IMC,	
	CASE
		WHEN VB01001 = 1 THEN 'MASCULINO'
		ELSE 'FEMININO'
	END AS SEXO,
	COUNT(VB17003) AS FREQUENCIA,
	COUNT(*) * 100.0 / SUM(COUNT(*)) OVER() AS PERCENTUAL
FROM [mova].[dbo].[PENSE_AMOSTRA2_ALUNO]
WHERE VB11007 IN (4,5) 
	AND (VB17003 / POWER((VB17004 /100),2) <= 18.5 OR VB17003 / POWER((VB17004 /100),2) >=30)
GROUP BY 
	CASE
		WHEN VB01001 = 1 THEN 'MASCULINO'
		ELSE 'FEMININO'
	END,
	CASE 
		WHEN VB17003 / POWER((VB17004 /100),2) <= 18.5 THEN 'ABAIXO DO PESO'
		WHEN VB17003 / POWER((VB17004 /100),2) >= 30 THEN 'ACIMA DO PESO'
		ELSE 'PESO NORMAL'
	END
ORDER BY CLASSE_IMC, SEXO
;

-- PERCENTUAL DOS IMC DOS GRUPO QUE ESTÃO INSATISFEITOS COM A APARENCIA CORPORAL ENTRE AS CLASSES DE SATISFACAO 
SELECT
	CASE 
		WHEN VB17003 / POWER((VB17004 /100),2) < 18.5 THEN 'ABAIXO DO PESO'
		WHEN VB17003 / POWER((VB17004 /100),2) > 30 THEN 'ACIMA DO PESO'
		ELSE 'PESO NORMAL'
	END AS CLASSE_IMC,	
	CASE 
		WHEN VB11007 IN (4) THEN 'INSATISFEITO'
		WHEN VB11007 IN (5) THEN 'MUITO INSATISFEITO'
		ELSE 'OUTROS'
	END AS SATISFACAO,
	COUNT(VB17003) AS FREQUENCIA,
	COUNT(*) * 100.0 / SUM(COUNT(*)) OVER() AS PERCENTUAL
FROM [mova].[dbo].[PENSE_AMOSTRA2_ALUNO]
WHERE VB11007 IN (4,5) 
	AND (VB17003 / POWER((VB17004 /100),2) <= 18.5 OR VB17003 / POWER((VB17004 /100),2) >=30)
GROUP BY 
	CASE 
		WHEN VB11007 IN (4) THEN 'INSATISFEITO'
		WHEN VB11007 IN (5) THEN 'MUITO INSATISFEITO'
		ELSE 'OUTROS'
	END,
	CASE 
		WHEN VB17003 / POWER((VB17004 /100),2) < 18.5 THEN 'ABAIXO DO PESO'
		WHEN VB17003 / POWER((VB17004 /100),2) > 30 THEN 'ACIMA DO PESO'
		ELSE 'PESO NORMAL'
	END
ORDER BY CLASSE_IMC, SATISFACAO
;